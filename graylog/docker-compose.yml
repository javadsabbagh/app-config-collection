version: '3.8'
services:
  mongodb:
      image: mongo:7.0.6
      container_name: mongodb
      ports:
        - "27017:27017"
      volumes:
        - /home/project/mongo/data:/data/db
      networks:
        - graylog-net

  graylog:
      image: graylog/graylog:5.2
      container_name: graylog
      environment:
      # Configuration items must start with GRAYLOG_ and be in all uppercase letters
      # Password encryption value, cannot be less than 16 characters
      # Run the following command to obtain: < /dev/urandom tr -dc A-Z-a-z-0-9 | head -c${1:-96};echo;
      - GRAYLOG_PASSWORD_SECRET=H8eNmvUlceXQGLuSejtN-klXoUpBzIYGShGsyoYvIm9YdMAIOmIWDYuGpHW4DLCL10UyEs5WgaXhj5wTd8g4x-ZOZOt831E7
      - GRAYLOG_HTTP_EXTERNAL_URI=http://0.0.0.0:9000/
      - GRAYLOG_WEB_ENDPOINT_URI=http://0.0.0.0:9000/api
      # Run the following command to obtain: echo -n "Enter Password: " && head -1 </dev/stdin | tr -d '\n' | sha256sum | cut -d" " -f1
      - GRAYLOG_ROOT_PASSWORD_SHA2=24510945175504e0de540a951f506c2dc9bc3981f31ef9ccec72aaca1636f2b3
      #- GRAYLOG_REST_LISTEN_URI=http://0.0.0.0:12900/
      - GRAYLOG_MONGODB_URI=mongodb://mongodb:27017/graylog
      # Although opensearch is used, the setting item name is still elasticsearch.
      - GRAYLOG_ELASTICSEARCH_HOSTS=https://opensearch:9200
      - GRAYLOG_ELASTICSEARCH_USERNAME=admin
      - GRAYLOG_ELASTICSEARCH_PASSWORD=admin@tata
      # Configure time zone
      - GRAYLOG_ROOT_TIMEZONE=Asia/Tehran
      ports:
      - "9000:9000"
      - "12201:12201/udp"
      networks:
      - graylog-net
      depends_on:
      - mongodb
      - opensearch

networks:
  graylog-net:
      driver: bridge